language: php
php:
  - 7
sudo: false
# download PHPoole
before_script:
  - curl -SOL https://phpoole.org/phpoole.phar
  - php phpoole.phar -v
# build
script:
  - php phpoole.phar build
# deploy
deploy:
  provider: script
  script: bash scripts/deploy.sh
  skip_cleanup: true
  overwrite: true
  on:
    branch: deploy
# purge cache
after_deploy:
  - "curl -X DELETE \"https://api.cloudflare.com/client/v4/zones/${Cloudflare_zone}/purge_cache\" \
    -H \"X-Auth-Email: arnaud@ligny.org\" \
    -H \"X-Auth-Key: ${Cloudflare_API}\" \
    -H \"Content-Type: application/json\" \
    --data '{\"purge_everything\":true}'"
